import{_ as e,o as s,c as a,a as n,b as t}from"./app.9a56070a.js";var p="/assets/vue-use-api.3068998a.png";const o={},c=t(`<blockquote><p>\u65E0\u8BBA\u662F\u5B9E\u73B0\u67D0\u4E2AAPI, \u8FD8\u662F\u65B0\u8BBE\u8BA1\u4E00\u4E2AAPI, \u90FD\u9700\u8981\u4ECE\u8FD9\u4E2AAPI\u600E\u4E48\u4F7F\u7528\u6765\u7740\u624B\xA0\xA0\xA0\xA0\xA0----\u9C81\u8FC5</p></blockquote><h2 id="vue-router\u57FA\u7840\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#vue-router\u57FA\u7840\u7528\u6CD5" aria-hidden="true">#</a> Vue-router\u57FA\u7840\u7528\u6CD5</h2><h3 id="\u57FA\u7840\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840\u7528\u6CD5" aria-hidden="true">#</a> \u57FA\u7840\u7528\u6CD5</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Home&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> Home
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/about&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;About&#39;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;about&quot; */</span> <span class="token string">&#39;../views/About.vue&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span>
          <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;@/views/AboutA&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><code>vue.use()</code>\u5982\u679C\u53C2\u6570\u4E3A\u5BF9\u8C61,\u5C31\u4F1A\u8C03\u7528\u8BE5\u5BF9\u8C61\u7684install\u65B9\u6CD5,\u6240\u4EE5Router\u5BF9\u8C61\u4E0A\u4F1A\u6709\u4E00\u4E2Ainstall\u65B9\u6CD5\u3002</li><li><code>new Router()</code>\u8BF4\u660EVue-router\u5BFC\u51FA\u4E00\u4E2A\u7C7B, \u5E76\u4E14\u63A5\u6536\u4E00\u4E2A\u53C2\u6570,\u53C2\u6570\u76EE\u524D\u770B\u662F\u4E00\u4E2A\u5BF9\u8C61</li><li>\u6302\u8F7DRouter\u5BF9\u8C61\u81F3Vue\u4E0A</li></ol><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>about<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>This is an about page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/about/a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AboutA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li><code>router-view</code>\u548C<code>router-link</code>\u7684\u4F7F\u7528</li></ol><h2 id="router-install" tabindex="-1"><a class="header-anchor" href="#router-install" aria-hidden="true">#</a> Router.install</h2><h3 id="vue-use\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#vue-use\u7528\u6CD5" aria-hidden="true">#</a> Vue.use\u7528\u6CD5</h3><p>Vue-router\u662F\u4F5C\u4E3AVue\u7684\u63D2\u4EF6\u6765\u690D\u5165\u7684,\u4E3A\u4E86\u66F4\u597D\u5730\u7406\u89E3,\u6211\u4EEC\u5148\u6765\u770B\u4E00\u4E0B<code>Vue.use()</code>\u7684\u5B9E\u73B0\u3002<br> \u4E0B\u56FE\u662F<a href="https://cn.vuejs.org/v2/api/#Vue-use" target="_blank" rel="noopener noreferrer">\u5B98\u65B9\u6587\u6863</a>\u4E2D\u5173\u4E8E<code>Vue.use()</code>\u7684\u63CF\u8FF0 <img src="`+p+`" alt="vue-use-api"><br> \u80FD\u603B\u7ED3\u51FA\u6765\u7684\u51E0\u4E2A\u7279\u70B9:</p><ol><li>\u53C2\u6570\u53EF\u4EE5\u662FObject/Function</li><li>\u53C2\u6570\u5982\u679C\u662FObject\u9700\u8981\u63D0\u4F9Binstall\u65B9\u6CD5,\u5982\u679C\u662FFunction\u7684\u8BDD,\u5219\u88AB\u5F53\u505Ainstall\u65B9\u6CD5\u6765\u6267\u884C</li><li>install\u65B9\u6CD5\u8C03\u7528\u4F1A\u5C06Vue\u4F20\u5165</li><li>\u63D2\u4EF6\u53EA\u4F1A\u88AB\u5B89\u88C5\u4E00\u6B21(\u8FD9\u4E2A\u4E4B\u540E\u5728install\u4E2D\u5B9E\u73B0)</li></ol><h3 id="vue-use\u6E90\u7801" tabindex="-1"><a class="header-anchor" href="#vue-use\u6E90\u7801" aria-hidden="true">#</a> Vue.use\u6E90\u7801</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//vue\u6E90\u7801 src/global-api/use.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> GlobalAPI <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;types/global-api&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toArray<span class="token punctuation">,</span> isFunction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../util/index&#39;</span>

<span class="token comment">//Vue.use\u5728initUse\u8FD9\u4E2A\u51FD\u6570\u58F0\u660E,Vue\u662F\u5728\u8C03\u7528initUse\u65F6\u4F20\u5165\u7684</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initUse</span><span class="token punctuation">(</span>Vue<span class="token operator">:</span> GlobalAPI<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>plugin<span class="token operator">:</span> <span class="token builtin">Function</span> <span class="token operator">|</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*\u4E0D\u662F\u5173\u6CE8\u91CD\u70B9,\u4EE3\u7801\u7701\u7565*/</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">//this \u6307\u5411 Vue \u5BF9\u8C61\uFF0C\u901A\u8FC7unshift()\u53EF\u4EE5\u4FDD\u8BC1\u6570\u7EC4\u53C2\u6570\u7B2C\u4E00\u4E2A\u59CB\u7EC8\u662Fvue\u5BF9\u8C61</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>install<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token comment">//\u5982\u679Cinstall\u5B58\u5728\u5E76\u4E14\u662F\u4E00\u4E2Afunction,\u8C03\u7528\u5E76\u4F20\u5165Vue.use\u7684\u53C2\u6570args</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token comment">//\u5982\u679Cplugin\u672C\u8EAB\u662F\u51FD\u6570,\u5219\u76F4\u63A5\u8C03\u7528,\u540C\u6837\u4F20\u5165args</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*\u4E0D\u662F\u5173\u6CE8\u91CD\u70B9,\u4EE3\u7801\u7701\u7565*/</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="install" tabindex="-1"><a class="header-anchor" href="#install" aria-hidden="true">#</a> install</h3><p>\u56DE\u5230vue-router,\u6211\u4EEC\u5BFC\u5165vue-router\u4E4B\u540E,\u4F1A\u4F7F\u7528<code>Vue.use(Router)</code>\u6765\u6CE8\u518C\u8DEF\u7531\u8FD9\u4E2A\u63D2\u4EF6(Vuex\u540C\u7406)\u3002<code>Vue.use()</code>\u53C8\u4F1A\u8C03\u7528install\u65B9\u6CD5<br> \u6240\u4EE5Router\u5BF9\u8C61\u9700\u8981\u58F0\u660E\u4E00\u4E2Ainstall\u65B9\u6CD5,\u5E76\u4E14\u7B2C\u4E00\u4E2A\u53C2\u6570\u8981\u4F20\u5165Vue\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//myRouter.js</span>
<span class="token keyword">import</span> install <span class="token keyword">from</span> <span class="token string">&#39;./install&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">myRouter</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u6838\u5FC3:\u6839\u636E\u4E0D\u540C\u7684\u8DEF\u5F84\u8DF3\u8F6C\u4E0D\u540C\u7684\u9875\u9762/\u7EC4\u4EF6</span>
  <span class="token keyword">static</span> <span class="token function-variable function">install</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  options
  <span class="token function">constructor</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
myRouter<span class="token punctuation">.</span>install <span class="token operator">=</span> install

<span class="token comment">//install.js</span>
<span class="token keyword">let</span> _Vue
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//\u5224\u65AD\u662F\u5426\u5B89\u88C5\u8FC7\u6B64\u63D2\u4EF6</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>install<span class="token punctuation">.</span>installed <span class="token operator">&amp;&amp;</span> _Vue <span class="token operator">===</span> Vue<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token comment">//Vue.use(Router) \u2192 Router.install(Vue) \u2192 Router.install.installed = true</span>
  <span class="token comment">//\u4E0B\u6B21\u518D\u4F7F\u7528Vue.use(Router),\u56E0\u4E3ARouter.install.installed === true,\u76F4\u63A5return</span>
  install<span class="token punctuation">.</span>installed <span class="token operator">=</span> <span class="token boolean">true</span>
  _Vue <span class="token operator">=</span> Vue
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>install()</code>\u901A\u8FC7<code>Vue.mixin()</code>\u5728\u6BCF\u4E2A\u7EC4\u4EF6\u4E0A\u90FD\u6302\u8F7D\u4E86_routerRoot\u5C5E\u6027, \u6307\u5411\u6839\u5B9E\u4F8Bapp;<br> \u5728\u6839\u5B9E\u4F8B\u4E0A\u8FD8\u6302\u8F7D\u4E86\u4F20\u5165<code>new Vue()</code>\u7684<code>$options.router</code><br> \u5E76\u8C03\u7528\u4E86Router\u5BF9\u8C61\u7684init\u65B9\u6CD5</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">//install.js</span>
<span class="token keyword">let</span> _Vue
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//\u6839\u7EC4\u4EF6\u6267\u884C</span>
        <span class="token comment">//\u4FDD\u5B58\u6839\u5B9E\u4F8B</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token comment">//\u4FDD\u5B58\u6839\u5B9E\u4F8B\u4E0A\u7684\u8DEF\u7531\u5B9E\u4F8B</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
        <span class="token comment">//</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u975E\u6839\u7EC4\u4EF6\u6267\u884C</span>
        <span class="token comment">//\u975E\u6839\u7EC4\u4EF6\u7684_routerRoot\u5C5E\u6027\u90FD\u6307\u5411&#39;#app&#39;\u7EC4\u4EF6</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>_routerRoot
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,18),i={class:"custom-container warning"},l={viewBox:"0 0 25 25",xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",style:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"}},u=n("path",{d:"M297.65 123.32C133.27 123.32 0 256.58 0 421c0 164.42 133.27 297.6 297.65 297.6 164.38 0 297.64-133.26 297.64-297.6 0-164.34-133.29-297.68-297.64-297.68Zm-.6 483.32c-22.591 0-41.18-18.589-41.18-41.18s18.589-41.18 41.18-41.18 41.18 18.589 41.18 41.18-18.589 41.18-41.18 41.18Zm42.38-164.27h-.23c-.139 22.489-18.681 40.916-41.17 40.916-22.586 0-41.171-18.585-41.171-41.171l.001-.255c0-1 .05-1.93.11-2.88V276.73h.03v-.27a45.8 45.8 0 0 1-.005-.642c0-22.59 18.589-41.18 41.18-41.18s41.18 18.59 41.18 41.18c0 .214-.002.428-.005.642v.27h.06l.02 165.64Z",style:{fill:"#f3cc2e","fill-rule":"nonzero"},transform:"matrix(.042 0 0 .042 0 -5.18)"},null,-1),r=[u],d=n("p",{class:"custom-container-title"},"WARNING",-1),k=n("p",null,"if\u91CC\u7684this\u6307\u5411main.js\u6587\u4EF6\u91CC\u7684\u521D\u59CB\u5316Vue\u7684\u90A3\u4E2A\u5B9E\u4F8B,else\u5219\u6307\u5411\u5404\u4E2AVue-component\u3002",-1),v=t(`<p>\u8FD9\u91CC\u901A\u8FC7<code>Vue.mixin()</code>\u6765\u5B8C\u6210\u8FD9\u4E2A\u6302\u8F7D\u7684\u539F\u56E0\u662F:</p><ol><li>\u4E0D\u80FD\u901A\u8FC7\u4F20\u5165\u7684\u8FD9\u4E2AVue\u6765\u6302\u8F7D,\u56E0\u4E3Ainstall\u6267\u884C\u7684\u65F6\u673A\u662F<code>Vue.use()</code>\u8C03\u7528\u7684\u65F6\u5019,\u800C\u5728\u8FD9\u65F6,<code>new Vue()</code>\u8FD8\u6CA1\u6709\u6267\u884C,\u8DEF\u7531\u914D\u7F6Erouter\u5C31\u6CA1\u6709\u6302\u8F7D\u5230Vue\u5B9E\u4F8B\u4E0A,<code>$options</code>\u4E0A\u5C31\u6CA1\u6709router\u5C5E\u6027</li><li>\u4E3A\u4E86\u83B7\u53D6new Vue()\u4E4B\u540E\u7684<code>$options.router</code>,\u901A\u8FC7Vue.mixin()\u4E2Dthis\u6307\u5411Vue\u5B9E\u4F8B\u8FD9\u4E2A\u7279\u6027,\u6765\u627E\u5230<code>$options.router</code></li></ol><h2 id="router\u7684\u6784\u9020\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#router\u7684\u6784\u9020\u51FD\u6570" aria-hidden="true">#</a> Router\u7684\u6784\u9020\u51FD\u6570</h2><h3 id="router\u6784\u5EFA\u9009\u9879" tabindex="-1"><a class="header-anchor" href="#router\u6784\u5EFA\u9009\u9879" aria-hidden="true">#</a> Router\u6784\u5EFA\u9009\u9879</h3><p><code>new Router()</code>\u521D\u59CB\u5316\u65F6\u63A5\u6536\u4E00\u4E2A<a href="https://v3.router.vuejs.org/zh/api/#router-%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9" target="_blank" rel="noopener noreferrer">\u5BF9\u8C61\u53C2\u6570</a>,\u672C\u6587\u805A\u7126\u4E8E\u5176\u4E2D\u7684<a href="https://v3.router.vuejs.org/zh/api/#routes" target="_blank" rel="noopener noreferrer">routes</a>\u3001<a href="https://v3.router.vuejs.org/zh/api/#mode" target="_blank" rel="noopener noreferrer">mode</a>\u3001<a href="https://v3.router.vuejs.org/zh/api/#base" target="_blank" rel="noopener noreferrer">base</a>\u3002</p><p>\u8DEF\u7531\u914D\u7F6E<code>routes</code>\u662F\u4E00\u4E2A\u6570\u7EC4,\u53EF\u5305\u542B<a href="https://v3.router.vuejs.org/zh/guide/essentials/nested-routes.html" target="_blank" rel="noopener noreferrer">\u5D4C\u5957\u8DEF\u7531</a>\u914D\u7F6E,\u4F46\u8FD9\u4E2A\u6570\u7EC4\u5BF9\u6211\u4EEC\u64CD\u4F5C\u8DEF\u7531\u6765\u8BF4\u4E0D\u662F\u5F88\u65B9\u4FBF,\u6240\u4EE5\u521D\u59CB\u5316\u65F6\u9700\u8981\u6241\u5E73\u5316\u5904\u7406\u4E00\u4E0B\u3002\u5904\u7406\u8FD9\u4E2A\u6B65\u9AA4\u7684\u6838\u5FC3\u65B9\u6CD5\u5C31\u662F<code>createMatcher</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> createMatcher <span class="token keyword">from</span> <span class="token string">&#39;./create-matcher&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">myRouter</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u6838\u5FC3:\u6839\u636E\u4E0D\u540C\u7684\u8DEF\u5F84\u8DF3\u8F6C\u4E0D\u540C\u7684\u9875\u9762/\u7EC4\u4EF6</span>
  <span class="token keyword">static</span> <span class="token function-variable function">install</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mather <span class="token operator">=</span> <span class="token function">createMatcher</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>routes <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//app:\u6839\u5B9E\u4F8B</span>
  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="creatematcher" tabindex="-1"><a class="header-anchor" href="#creatematcher" aria-hidden="true">#</a> createMatcher</h3><p><code>createMatcher</code>\u8FD4\u56DE2\u4E2A\u65B9\u6CD5(\u6E90\u7801\u4E2D\u8FD4\u56DE4\u4E2A\u65B9\u6CD5,\u8FD9\u91CC\u7B80\u5316\u4E86),addRoutes\u7528\u6765\u52A8\u6001\u6DFB\u52A0\u8DEF\u7531\u914D\u7F6E,math\u7528\u6765\u5339\u914D\u8DEF\u5F84;<br><code>createMatcher</code>\u4E2D\u5904\u7406\u8DEF\u7531\u914D\u7F6E\u6241\u5E73\u5316\u7684\u65B9\u6CD5\u4E3A<code>createRouteMap</code><br><code>match</code>\u65B9\u6CD5\u5728\u4E4B\u540E\u7684History\u57FA\u7C7B\u4E2D\u4F1A\u7528\u5230,\u8FD9\u91CC\u5148\u4E0D\u8BA8\u8BBA</p><p>create-matcher.js\u4EE3\u7801:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//create-matcher.js</span>
<span class="token keyword">import</span> createRouteMap <span class="token keyword">from</span> <span class="token string">&#39;./create-route-map&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createRoute<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/lib/utils/route&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createMatcher</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//\u6241\u5E73\u5316routes</span>
  <span class="token comment">//\u5C06\u4F20\u5165\u7684routes\u8F6C\u6362\u6210\u8DEF\u5F84\u5B57\u7B26\u4E32\u548C\u5BF9\u5E94\u7EC4\u4EF6\u6620\u5C04\u7684\u6570\u636E\u7ED3\u6784</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>pathList<span class="token punctuation">,</span>pathMap<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createRouteMap</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
  
  <span class="token comment">//\u5339\u914D\u8DEF\u5F84,\u7528location\u5728pathMap\u91CC\u627E\u5230\u5BF9\u5E94\u7684\u8BB0\u5F55</span>
  <span class="token comment">//\u8FD4\u56DE{path: &#39;/about/a&#39;, matched: [About,AboutA]}</span>
  <span class="token keyword">function</span> <span class="token function">match</span> <span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> record <span class="token operator">=</span> pathMap<span class="token punctuation">[</span>location<span class="token punctuation">]</span>
    <span class="token keyword">let</span> local <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> location
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">createRoute</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> local<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> local<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">function</span> <span class="token function">addRoutes</span> <span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u6DFB\u52A0\u65B0\u8DEF\u7531,\u9700\u8981\u5C06\u65B0\u6DFB\u52A0\u7684\u8DEF\u7531\u66F4\u65B0\u81F3pathList\u548CpathMap\u4E2D</span>
    <span class="token function">createRouteMap</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u6E90\u7801\u4E2D\u8FD4\u56DE\u56DB\u4E2A</span>
    match<span class="token punctuation">,</span>
    addRoutes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="createroutemap" tabindex="-1"><a class="header-anchor" href="#createroutemap" aria-hidden="true">#</a> createRouteMap</h3><p><code>createRouteMap</code>\u5904\u7406\u8DEF\u7531\u914D\u7F6E,\u8FD4\u56DE\u8DEF\u7531\u8DEF\u5F84pathList\u548C\u8DEF\u7531\u8DEF\u5F84\u548C\u8DEF\u7531\u5176\u4ED6\u4FE1\u606F\u7684\u6620\u5C04\u8868pathMap;<br> \u5176\u4E2D\u7684<code>addRouteRecord</code>\u65B9\u6CD5\u4E2D, \u5B9A\u4E49\u4E86\u5982\u4F55\u5904\u7406routes,\u7136\u540E\u751F\u6210pathList\u548CpathMap;<br> \u5982\u679C\u8DEF\u7531\u914D\u7F6E\u542B\u6709\u5D4C\u5957\u8DEF\u7531,\u9012\u5F52\u6267\u884C<code>addRouteRecord</code>\u3002</p><p>create-route-map.js\u4EE3\u7801:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//create-route-map.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span>oldPathList<span class="token punctuation">,</span>oldPathMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pathList <span class="token operator">=</span> oldPathList <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> pathMap <span class="token operator">=</span> oldPathMap <span class="token operator">||</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">addRouteRecord</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">//pathList\u7ED3\u6784</span>
    <span class="token comment">//[&#39;/&#39;,&#39;/about&#39;,&#39;/about/user1&#39;]</span>
    pathList<span class="token punctuation">,</span>
    <span class="token comment">//pathMap\u7ED3\u6784</span>
    <span class="token comment">//{&#39;/&#39;: record,&#39;/about&#39;,record,&#39;/about/user1&#39;,record}</span>
    pathMap
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">addRouteRecord</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//parent\u4E0D\u5B58\u5728: path = &#39;/about&#39;</span>
  <span class="token comment">//parent\u5B58\u5728: path = &#39;/about/a&#39;</span>
  <span class="token keyword">let</span> path <span class="token operator">=</span> parent <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>parent<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>route<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span> <span class="token operator">:</span>route<span class="token punctuation">.</span>path
  <span class="token keyword">let</span> component <span class="token operator">=</span> route<span class="token punctuation">.</span>component
  <span class="token comment">//record\u4E2D\u4FDD\u5B58\u5728\u8DEF\u7531\u7684\u4E00\u4E9B\u4FE1\u606F,\u6E90\u7801\u4E2D\u4FE1\u606F\u6709\u5F88\u591A,\u8FD9\u91CC\u8FDB\u884C\u4E86\u7B80\u5316</span>
  <span class="token keyword">let</span> record <span class="token operator">=</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">,</span>
    component<span class="token punctuation">,</span>
    parent
  <span class="token punctuation">}</span>
  <span class="token comment">//\u8DEF\u7531\u521D\u59CB\u5316\u65F6,pathList\u548CpathMap\u80AF\u5B9A\u662F\u6CA1\u6709\u503C\u7684</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>pathMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    pathList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    pathMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> record
  <span class="token punctuation">}</span>
  <span class="token comment">//\u5982\u679C\u662F\u5D4C\u5957\u8DEF\u7531</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">{</span>
    route<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">addRouteRecord</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> pathList<span class="token punctuation">,</span> pathMap<span class="token punctuation">,</span> record<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mode\u9009\u9879" tabindex="-1"><a class="header-anchor" href="#mode\u9009\u9879" aria-hidden="true">#</a> mode\u9009\u9879</h3><p><code>new Router()</code>\u521D\u59CB\u5316\u65F6\u63A5\u6536\u53C2\u6570\u4E2D,mode\u7528\u6765\u6307\u5B9A\u542F\u7528hash\u6A21\u5F0F\u8FD8\u662Fhistory\u6A21\u5F0F(abstract\u672C\u6587\u4E0D\u8BA8\u8BBA)<br> Router\u5BF9\u8C61\u7684\u6784\u5EFA\u9009\u9879\u4E2D,\u4F1A\u521D\u59CB\u5316\u4E00\u4E2A\u503C\u7528\u6765\u6307\u5B9A\u6A21\u5F0F, \u6839\u636E\u4F20\u5165\u7684mode\u503C\u6765\u5206\u522B\u4F7F\u7528HashHistory/H5History</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> HashHistory <span class="token keyword">from</span> <span class="token string">&#39;./history/HashHistory&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">myRouter</span> <span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  mode
  hitory
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> options<span class="token punctuation">.</span>mode <span class="token operator">||</span> <span class="token string">&#39;hash&#39;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>HashHistory</code>\u7C7B\u7EE7\u627F\u57FA\u7C7B<code>History</code>,\u4F20\u5165<code>new Router()</code>\u751F\u6210\u7684\u5B9E\u4F8B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//HashHistory.js</span>
<span class="token keyword">import</span> History <span class="token keyword">from</span> <span class="token string">&#39;./base&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HashHistory</span> <span class="token keyword">extends</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//base.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>router <span class="token operator">=</span> router
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="router-init" tabindex="-1"><a class="header-anchor" href="#router-init" aria-hidden="true">#</a> Router.init()</h3><p>\u5728\u8DEF\u7531\u521D\u59CB\u5316\u65F6,\u5C31\u4F7F\u7528\u5230\u4E86<code>History\u7C7B</code><br> \u6211\u4EEC\u5728<code>Vue.use(Router)</code>\u65F6,\u6267\u884C\u4E86Router\u5185\u90E8\u7684<code>install</code>\u65B9\u6CD5,<code>install</code>\u65B9\u6CD5\u5185\u90E8\u5728\u6839\u5B9E\u4F8B\u65F6\u53C8\u6267\u884C\u4E86Router\u5BF9\u8C61\u7684<code>init</code>\u65B9\u6CD5\u3002\u73B0\u5728\u6211\u4EEC\u6765\u770B\u4E0Binit\u65B9\u6CD5\u662F\u600E\u4E48\u6267\u884C\u7684\u3002<br> \u521D\u59CB\u5316\u65F6, \u8DEF\u7531\u9700\u8981\u8DF3\u8F6C\u5230\u9875\u9762\u7684\u5165\u53E3\u5E76\u6E32\u67D3\u54CD\u5E94\u7EC4\u4EF6, \u6211\u4EEC\u5B9A\u4E49\u4E00\u4E2A<code>transitionTo</code>\u65B9\u6CD5\u6765\u5B9E\u73B0<br><code>transitionTo</code>\u63A5\u6536\u4E24\u4E2A\u53C2\u6570,\u8DEF\u5F84\u548C\u56DE\u8C03\u51FD\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">myRouter</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//\u6839\u5B9E\u4F8B</span>
    <span class="token comment">//\u6839\u636E\u5F53\u524D\u8DEF\u7531,\u663E\u793A\u81F3\u6307\u5B9A\u7EC4\u4EF6</span>
    <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>history
    <span class="token keyword">const</span> <span class="token function-variable function">setupHashListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      history<span class="token punctuation">.</span><span class="token function">setupListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    history<span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>
      history<span class="token punctuation">.</span><span class="token function">getCurrentLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      setupHashListener
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>transitionTo</code>\u662Fhash\u3001history\u3001abstract\u6A21\u5F0F\u516C\u5171\u65B9\u6CD5,\u5B9A\u4E49\u5728<code>base\u57FA\u7C7B</code>\u4E0A \u5185\u90E8\u6839\u636E\u8DEF\u7531\u5730\u5740location,\u901A\u8FC7Router\u5BF9\u8C61\u4E0A\u7684<code>match</code>\u65B9\u6CD5\u6765\u5339\u914D\u51FA\u5BF9\u5E94\u7684\u7EC4\u4EF6<br><code>base\u57FA\u7C7B</code>\u5185\u90E8\u7EF4\u62A4\u4E00\u4E2A<code>current</code>\u53D8\u91CF,\u7528\u6765\u4FDD\u5B58\u5F53\u524D\u7684\u8DEF\u5F84\u548C\u7EC4\u4EF6\u4FE1\u606F<br> \u5728\u76D1\u542C\u5230hash\u53D8\u5316\u65F6,\u627E\u5230\u65B0\u8DEF\u5F84\u7684\u5BF9\u5E94\u4FE1\u606F,\u66F4\u65B0\u81F3<code>current</code>(\u540E\u9762\u4F1A\u4F5C\u76F8\u5E94\u7684\u54CD\u5E94\u5F0F\u5904\u7406)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//base.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createRoute<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/lib/utils/route&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>router <span class="token operator">=</span> router
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//onComplete\u8DEF\u7531\u53D8\u5316\u540E\u7684\u56DE\u8C03</span>
  <span class="token function">transitionTo</span><span class="token punctuation">(</span><span class="token parameter">location<span class="token punctuation">,</span> onComplete</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> newRoute <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
    <span class="token comment">//\u8FD9\u91CC\u8FDB\u884C\u4E86\u7B80\u5316</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>path <span class="token operator">===</span> newRoute<span class="token punctuation">.</span>path <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length <span class="token operator">===</span> newRoute<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRoute</span><span class="token punctuation">(</span>newRoute<span class="token punctuation">)</span>
    onComplete <span class="token operator">&amp;&amp;</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateRoute</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u53EF\u4EE5\u56DE\u5230<a href="#creatematcher"><em>create-matcher</em></a>\u4EE3\u7801<br><code>match</code>\u65B9\u6CD5\u6839\u636E\u4F20\u5165\u7684\u8DEF\u5F84location,\u5728pathMap\u4E2D\u5BFB\u627E\u5BF9\u5E94\u8DEF\u5F84\u7684record\u8BB0\u5F55<br> \u8FD4\u56DE<code>createRoute()</code>\u65B9\u6CD5\u7684\u7ED3\u679C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//create-matcher.js</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  <span class="token comment">//\u5339\u914D\u8DEF\u5F84,\u7528location\u5728pathMap\u91CC\u627E\u5230\u5BF9\u5E94\u7684\u8BB0\u5F55</span>
  <span class="token comment">//\u8FD4\u56DE{path: &#39;/about/a&#39;, matched: [About,AboutA]}</span>
  <span class="token keyword">function</span> <span class="token function">match</span> <span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> record <span class="token operator">=</span> pathMap<span class="token punctuation">[</span>location<span class="token punctuation">]</span>
    <span class="token keyword">let</span> local <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> location
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">createRoute</span><span class="token punctuation">(</span>record<span class="token punctuation">,</span> local<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> local<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>createRoute</code>\u662F\u4E00\u4E2A\u5DE5\u5177\u51FD\u6570<br> \u6838\u5FC3\u903B\u8F91\u662F\u6784\u9020\u4E00\u4E2A\u5E26\u6709\u8DEF\u5F84\u548C\u8DEF\u5F84\u5BF9\u5E94record\u7684\u6570\u636E\u7ED3\u6784<br> \u7279\u522B\u662F\u9488\u5BF9\u5D4C\u5957\u8DEF\u7531, \u4F1A\u5C06\u5D4C\u5957\u8DEF\u7531\u7684\u7EC4\u4EF6\u4F9D\u6B21\u653E\u5165matched\u6570\u7EC4\u4E2D,\u4E4B\u540E\u4F9D\u6B21\u6E32\u67D3</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>result <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">location</span><span class="token operator">:</span> <span class="token string">&#39;/about&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">matched</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token literal-property property">About</span><span class="token operator">:</span>  About<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token literal-property property">AboutA</span><span class="token operator">:</span> AboutA<span class="token punctuation">}</span><span class="token comment">//about\u5BF9\u5E94\u7684component</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token parameter">record<span class="token punctuation">,</span> location</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
      record <span class="token operator">=</span> record<span class="token punctuation">.</span>parent
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>location<span class="token punctuation">,</span>
    <span class="token literal-property property">matched</span><span class="token operator">:</span> res
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728<code>init()</code>\u4E2D,\u8FD8\u6709\u4E00\u4E2A\u5B9A\u4E49\u5728<code>HashHistory\u7C7B</code>\u4E0A\u83B7\u53D6\u5F53\u524D\u8DEF\u7531hash\u503C\u7684<code>getCurrentLocation</code>\u65B9\u6CD5<br> \u6838\u5FC3\u903B\u8F91\u662F\u83B7\u53D6<code>window.location.href</code>\u7684\u503C,\u5E76\u53BB\u9664<code>#</code>\u4E4B\u524D\u7684\u5B57\u7B26,\u5F97\u5230\u8DEF\u5F84<br> \u8FD9\u91CC\u4E0D\u4F7F\u7528<code>window.location.hash</code>\u7684\u539F\u56E0\u662FFirefox\u4E0D\u652F\u6301</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//HashHistory.js</span>
<span class="token keyword">function</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//&#39;http://localhost:8080/#/about&#39; \u2192 &#39;/about&#39;</span>
  <span class="token keyword">let</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
  <span class="token keyword">const</span> index <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#39;&#39;</span>
  <span class="token keyword">return</span> href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HashHistory</span> <span class="token keyword">extends</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  <span class="token function">getCurrentLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>init()</code>\u4E2D,<code>setupListeners</code>\u5728\u6E90\u7801\u4E2D\u662F\u5B9A\u4E49\u5728\u5728<code>base\u57FA\u7C7B</code>\u4E0A,\u4F46\u662F\u4E2A\u7A7A\u65B9\u6CD5,\u5728<code>HashHistory</code>\u7EE7\u627F\u57FA\u7C7B\u65F6\u8986\u5199\u8FD9\u4E2A\u65B9\u6CD5,\u8FD9\u91CC\u53EA\u5B9E\u73B0\u5176\u6838\u5FC3\u903B\u8F91<br> \u5728<code>getCurrentLocation</code>\u6267\u884C\u5B8C,\u8BBE\u7F6Ehash\u503C\u7684\u76D1\u542C\u5668, \u5728\u6211\u4EEC\u6539\u53D8URL\u65F6\u6267\u884C\u56DE\u8C03\u51FD\u6570(\u4E5F\u5C31\u662FURL\u6539\u53D8\u65F6\u6E32\u67D3\u5BF9\u5E94\u7EC4\u4EF6)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">HashHistory</span> <span class="token keyword">extends</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  <span class="token function">setupListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;hashchange&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span><span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8DEF\u5F84\u7684\u54CD\u5E94\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u8DEF\u5F84\u7684\u54CD\u5E94\u5F0F" aria-hidden="true">#</a> \u8DEF\u5F84\u7684\u54CD\u5E94\u5F0F</h3><h3 id="\u9ED8\u8BA4\u8DEF\u5F84" tabindex="-1"><a class="header-anchor" href="#\u9ED8\u8BA4\u8DEF\u5F84" aria-hidden="true">#</a> \u9ED8\u8BA4\u8DEF\u5F84</h3><p>\u5F53\u9ED8\u8BA4\u8DEF\u5F84\u4E3A\u7A7A, \u4F8B\u5982: <code>http://localhost:8080</code>\u65F6,\u9875\u9762\u4E0D\u4F1A\u8DF3\u8F6C\u81F3\u9ED8\u8BA4\u7EC4\u4EF6,\u56E0\u4E3A\u8FD9\u65F6\u5019\u6211\u4EEC\u542F\u7528\u7684hash\u6A21\u5F0F,\u9ED8\u8BA4\u8DEF\u5F84\u4E3A\u7A7A\u5E76\u4E0D\u80FD\u8DF3\u8F6C\u81F3\u6307\u5B9A\u8DEF\u5F84,\u4E5F\u5C31\u4E0D\u80FD\u6E32\u67D3\u5BF9\u5E94\u7684\u7EC4\u4EF6\u3002<code>HashHistory.js</code>\u9700\u8981\u518D\u6539\u9020\u4E00\u4E0B<br><code>ensureSlash()</code>\u7528\u6765\u5224\u65AD\u83B7\u5F97\u7684hash\u503C\u7B2C\u4E00\u4E2A\u5B57\u7B26\u662F\u5426\u4E3A<code>/</code>,\u5982\u679C\u4E0D\u662F<code>/</code>,\u8C03\u7528<code>replaceHash(&#39;/&#39;+ &#39;&#39;)</code>,\u5728HashHistory\u7684\u6784\u9020\u51FD\u6570\u4E2D\u8C03\u7528;<br><code>replaceHash()</code>\u66FF\u6362\u8DEF\u5F84<br><code>getUrl(path)</code>\u8FD4\u56DE\u4E0D\u5E26<code>#</code>\u7684\u57FA\u7840\u8DEF\u5F84+path\u53C2\u6570\u7EC4\u5408\u800C\u6210\u7684\u8DEF\u5F84</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//HashHistory.js</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
<span class="token keyword">function</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//&#39;http://localhost:8080/#/about&#39; \u2192 &#39;/about&#39;</span>
  <span class="token keyword">let</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
  <span class="token keyword">const</span> index <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&#39;&#39;</span>
  <span class="token keyword">return</span> href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">ensureSlash</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">replaceHash</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span> <span class="token operator">+</span> path<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getUrl</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//getUrl(&#39;/&#39;)</span>
  <span class="token comment">//http://localhost:8081/#/about \u2192 &#39;http://localhost:8081/#/&#39;</span>
  <span class="token keyword">const</span> href <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
  <span class="token keyword">const</span> i <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> base <span class="token operator">=</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">?</span> href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> href
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">replaceHash</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//replaceHash(&#39;/&#39;)</span>
  <span class="token comment">//&#39;http://localhost:8081&#39; \u2192 &#39;http://localhost:8081/#/&#39;</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u4EE5\u4E0A\u4EE3\u7801,\u5728\u8DEF\u5F84\u53D1\u751F\u53D8\u5316\u65F6,\u8DEF\u5F84\u548C\u8DEF\u5F84\u5BF9\u5E94\u7EC4\u4EF6\u4F1A\u6210\u529F\u4FDD\u5B58/\u6267\u884C,\u4F46\u8FD9\u65F6\u5019\u9875\u9762\u8FD8\u4E0D\u4F1A\u6E32\u67D3<br> \u539F\u56E0\u662F,\u4FDD\u5B58\u5F53\u524D\u8DEF\u5F84\u4FE1\u606F\u7684<code>current</code>\u53EA\u662F\u7EF4\u62A4\u5728<code>base\u57FA\u7C7B</code>\u5185\u90E8,<code>Vue</code>\u5E76\u4E0D\u80FD\u505A\u51FA\u54CD\u5E94\u5F0F\u7684\u6E32\u67D3<br> \u6211\u4EEC\u5728<code>Vue.mixin</code>\u65F6,\u5BF9\u6839\u5B9E\u4F8B\u65B0\u589E\u4E00\u4E2A\u79C1\u6709\u5C5E\u6027<code>_route</code>,\u5C06<code>current</code>\u7ED1\u5B9A\u5728\u4E0A\u9762</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//install.js</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u4F7Fcurrent\u79F0\u4E3A\u54CD\u5E94\u5F0F</span>
      Vue<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&#39;_route&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_router<span class="token punctuation">.</span>history<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_router</code>\u662F\u6211\u4EEC\u7684Router\u5BF9\u8C61,\u7EF4\u62A4\u4E86<code>history</code>\u5BF9\u8C61,<code>current</code>\u5C5E\u6027\u5C31\u4FDD\u5B58\u5728\u4E0A\u9762\u3002<br> \u518D\u901A\u8FC7\u66B4\u9732<code>$route</code>\u548C<code>$router</code>\u6765\u63D0\u4F9B\u8BBF\u95EE</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//install.js</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&#39;$route&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot<span class="token punctuation">.</span>_route
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&#39;$router&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_routerRoot<span class="token punctuation">.</span>_router
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56DE\u5230<a href="#router-init"><em>transitionTo</em></a>,\u6211\u4EEC\u5728\u6839\u636E\u8DEF\u5F84\u66F4\u65B0<code>current</code>\u65F6\u9700\u8981\u4E00\u5E76\u66F4\u65B0<code>_route</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//myRouter.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">myRouter</span> <span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span>_route <span class="token operator">=</span> route
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//base.js</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">router</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>router <span class="token operator">=</span> router
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  <span class="token function">updateRoute</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> route
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\u6211\u4EEC\u5B9E\u73B0\u4E86<code>_route</code>\u7684\u54CD\u5E94\u5F0F, \u4E4B\u540E\u5728<code>RouterView</code>\u548C<code>RouterLink</code>\u4E2D\u6211\u4EEC\u5C31\u53EF\u4EE5\u6839\u636E<code>_route</code>\u6765\u6E32\u67D3\u5BF9\u5E94\u89C6\u56FE</p><h2 id="router-view" tabindex="-1"><a class="header-anchor" href="#router-view" aria-hidden="true">#</a> router-view</h2><p>\u5229\u7528\u51FD\u6570\u5F0F\u7EC4\u4EF6\u6765\u521B\u5EFA<code>router-view</code><br> \u5728<code>new Vue()</code>\u4E4B\u524D\u6CE8\u518C\u7EC4\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//install.js</span>
<span class="token keyword">import</span> RouterView <span class="token keyword">from</span> <span class="token string">&#39;@/lib/components/view&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">/*-----\u91CD\u590D\u4EE3\u7801\u7701\u7565-----*/</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;RouterView&#39;</span><span class="token punctuation">,</span> RouterView<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//RouterView.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;RouterView&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">functional</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span>parent<span class="token punctuation">,</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> route <span class="token operator">=</span> parent<span class="token punctuation">.</span>$route
    <span class="token keyword">let</span> matched <span class="token operator">=</span> route<span class="token punctuation">.</span>matched
    data<span class="token punctuation">.</span>routerView <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">let</span> depth <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$vnode <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>$vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>routerView<span class="token punctuation">)</span><span class="token punctuation">{</span>
        depth<span class="token operator">++</span>
      <span class="token punctuation">}</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> record <span class="token operator">=</span> matched<span class="token punctuation">[</span>depth<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>component<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,51);function m(b,h){return s(),a("div",null,[c,n("div",i,[(s(),a("svg",l,r)),d,k]),v])}var w=e(o,[["render",m],["__file","2022-06-01-vue-router.html.vue"]]);export{w as default};
